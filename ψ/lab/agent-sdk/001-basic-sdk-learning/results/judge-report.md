# POC Experiment Code Review

> **Judge**: Main Agent (Opus)
> **Date**: 2025-12-11
> **Status**: Review Complete - Fixes Required

---

## Summary Scores

| Experiment | Correctness | Educational | Runnable | Complete | Total |
|------------|-------------|-------------|----------|----------|-------|
| 01-basic | 7/10 | 9/10 | 6/10 | 8/10 | **30/40** |
| 02-v2 | 4/10 | 8/10 | 3/10 | 7/10 | **22/40** |
| 03-tools | 6/10 | 8/10 | 5/10 | 7/10 | **26/40** |

**Overall**: 78/120 (65%) - NOT READY TO RUN

---

## Root Cause

All 3 experiments have **API signature mismatches** with actual SDK v0.1.61:

| Issue | Expected | Written |
|-------|----------|---------|
| `query()` | `{ prompt, options }` | `{ model, messages, tools }` |
| `unstable_v2_prompt()` | `(message, options)` | `(client, options)` |
| `unstable_v2_createSession()` | `(options)` | `(client, options)` |

---

## Detailed Review

### 01-basic-query.ts (30/40)

**Strengths:**
- Excellent educational comments
- Good message type handling
- Includes timing and token usage

**Issues:**
- Options nesting may be incorrect
- Unsafe type assertions
- No timeout handling

**Verdict**: NEEDS_FIX (minor)

---

### 02-v2-session.ts (22/40)

**Strengths:**
- Great V1 vs V2 comparison
- Clear pattern demonstration
- Good documentation

**Critical Issues:**
- Uses non-existent `client` parameter
- `createMockClient()` returns empty object
- API calls fundamentally wrong

**Verdict**: NEEDS_FIX (major rewrite)

---

### 03-tools-sandbox.ts (26/40)

**Strengths:**
- Good tool configuration examples
- Sandbox reference is thorough
- Clear structure

**Issues:**
- Uses `messages` instead of `prompt`
- Tools array format unclear
- ConfigD never executed

**Verdict**: NEEDS_FIX (moderate)

---

## Fixes Required

### 01-basic-query.ts

```typescript
// Line 49 - Fix query call
const queryGenerator = query({
  prompt,
  options: {
    model: 'claude-sonnet-4-5-20250929',
    maxTurns: 1
  }
})
```

### 02-v2-session.ts

```typescript
// Line 36 - Fix unstable_v2_prompt
const response = await unstable_v2_prompt(
  'What is the capital of France?',
  { model: 'claude-sonnet-4-5-20250929' }
)

// Line 60 - Fix unstable_v2_createSession
const session = await unstable_v2_createSession({
  model: 'claude-sonnet-4-5-20250929'
})
```

### 03-tools-sandbox.ts

```typescript
// Lines 44, 65, 85 - Fix query pattern
const response = query({
  prompt: TEST_PROMPT,
  options: {
    tools: { type: 'preset', preset: 'claude_code' }
  }
})
```

---

## Recommendation

**Option B Selected**: Keep as reference, create detailed plan before fixing.

### Why?
1. Need to verify actual SDK API from source
2. Educational value is preserved
3. Avoid fixing blindly

### Next Steps
1. Read actual SDK types/source
2. Create PLAN.md with correct API usage
3. Then fix with confidence

---

*Report generated by Judge Agent*
