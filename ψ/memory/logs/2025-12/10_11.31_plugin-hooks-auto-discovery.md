# Plugin Hooks Auto-Discovery

**Time**: 11:31 GMT+7

## What We Learned

- Claude Code plugins use **auto-discovery** for commands and hooks - don't specify paths in plugin.json
- Hooks must be in `hooks/hooks.json` folder structure, not `hooks.json` at root
- Format matters: `{"SessionStart": [...]}` not `{"hooks": {"SessionStart": [...]}}`
- **Plugin hooks from local marketplaces don't merge** with global settings.json hooks for same event types
- SessionStart hook stdout gets injected as conversation context - powerful for knowledge injection

## How Things Connect

- **Plugin structure → Auto-discovery**: Standard folder names (`commands/`, `hooks/`, `skills/`) enable discovery without explicit paths
- **hooks.json location → Loading**: Claude Code expects `hooks/hooks.json` not root-level `hooks.json`
- **hooks format → Parser**: Direct event types at root level, no wrapper object
- **SessionStart stdout → Context**: Output from hooks becomes part of Claude's conversation context
- **Local marketplace → Global settings**: Plugin hooks don't combine with settings.json - need workaround

## Key Discoveries

1. **Compare working vs broken**: voice-notify worked, nat-data-personal didn't - structural comparison revealed all issues
2. **Auto-discovery > Explicit**: Working plugins have NO `commands`/`hooks` fields in plugin.json
3. **Plugin hook isolation**: Each plugin's hooks seem isolated; don't merge with global for same event type
4. **Workaround needed**: For SessionStart knowledge injection, add directly to `~/.claude/settings.json`

## Commits

- `1af04a7` fix: plugin structure for auto-discovery + hooks format
- `e681a29` fix: nat-data-personal hooks.json format for SessionStart injection
- `3a8863c` feat: add /oracle-init command to download philosophy via curl

## Tags

`plugins` `hooks` `auto-discovery` `sessionstart` `knowledge-injection` `debugging`

## Raw Thoughts

- Is plugin hook non-merging a bug or feature? Should report to Claude Code team
- `${CLAUDE_PLUGIN_ROOT}` might not resolve for local marketplace plugins - needs more testing
- This pattern (SessionStart stdout → context) is powerful for personality/knowledge injection
- Could create a "personality" plugin pattern: philosophy + writing-style files auto-injected
- The debugging took 25 min but documentation took longer - worth it for future reference
