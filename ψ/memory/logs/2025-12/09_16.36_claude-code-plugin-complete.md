# Claude Code Plugin — Complete Journey

**Time**: 16:36 GMT+7

## What We Learned

- **`pluginDirectories` doesn't exist** — Wasted time on wrong setting name
- **Marketplace structure required** — Even local plugins need `marketplace.json`
- **`source: "."` vs `source: "./"` matters** — Validation catches this
- **`${CLAUDE_PLUGIN_ROOT}` is essential** — For portable hook paths
- **Skills are model-invoked** — Claude decides when to use, not user
- **Commands are user-invoked** — Explicit `/command` typing

## How Things Connect

- **Hooks → Scripts**: `hooks.json` calls shell scripts via `${CLAUDE_PLUGIN_ROOT}`
- **Marketplace → Plugin**: `marketplace.json` wraps `plugin.json` for discovery
- **Settings → Marketplace**: `extraKnownMarketplaces` registers local paths
- **Skills → Description**: Claude reads `description` field to decide when to use

## Key Discoveries

### Plugin Structure

```
.claude-plugin/
├── plugin.json       # Required
└── marketplace.json  # Required for /plugin discovery
```

### Settings Format

```json
{
  "extraKnownMarketplaces": {
    "name": {
      "source": { "source": "directory", "path": "/absolute/path" }
    }
  }
}
```

### Validation Command

```bash
claude plugin validate /path  # Run BEFORE install!
```

### All 10 Hook Events

PreToolUse, PostToolUse, SubagentStop, Stop, SessionStart, SessionEnd, PreCompact, UserPromptSubmit, Notification, PermissionRequest

## Commits

- `6e800ee` docs: Claude Code plugin journey — blog content ready
- `dd1e2b7` fix: use extraKnownMarketplaces for plugin config
- `626b27d` config: add claude-voice-notify plugin directory
- `3705d09` feat: add agents and commands from weyermann
- `2201914` docs: Claude Code plugin components analysis
- `e890826` refactor: migrate voice scripts to claude-voice-notify repo

## Tags

`claude-code` `plugin` `marketplace` `hooks` `skills` `commands` `voice-notify`

## Raw Thoughts

- Documentation gaps are real — `pluginDirectories` appears in some examples but doesn't work
- The marketplace system is powerful but over-engineered for single plugins
- Skills feel magical but debugging is hard ("why didn't it use my skill?")
- `claude plugin validate` should be run automatically on install
- Future: system tray app with SQLite would be much cleaner than file locks
