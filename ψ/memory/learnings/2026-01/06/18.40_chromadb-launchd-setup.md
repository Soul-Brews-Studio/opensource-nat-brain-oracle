# ChromaDB macOS Launchd Service Setup

**Date**: 2026-01-06
**Context**: Setting up ChromaDB as a persistent macOS service for oracle-v2 hybrid search

## What We Learned

- ChromaDB should run as a **system service**, not spawned by the app
- The command is `chroma` not `chromadb`: `uvx --from chromadb chroma run`
- Data path must match between launchd service and indexer config
- ChromaDB v2 API deprecated v1 endpoints

## Why It Matters

- **Reliability**: ChromaDB auto-starts on boot, persists across sessions
- **Separation of concerns**: Database server independent of application
- **Hybrid search**: FTS5 (keywords) + ChromaDB (semantic) = better results
- **Production-ready**: PID files, graceful shutdown, proper service management

## How To Apply

```bash
# Create launchd plist
cat > ~/Library/LaunchAgents/com.chromadb.server.plist << 'EOF'
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
    <key>Label</key>
    <string>com.chromadb.server</string>
    <key>ProgramArguments</key>
    <array>
        <string>/opt/homebrew/bin/uvx</string>
        <string>--from</string>
        <string>chromadb</string>
        <string>chroma</string>
        <string>run</string>
        <string>--path</string>
        <string>/Users/nat/.chromadb</string>
    </array>
    <key>RunAtLoad</key>
    <true/>
    <key>KeepAlive</key>
    <true/>
    <key>StandardOutPath</key>
    <string>/tmp/chromadb.log</string>
    <key>StandardErrorPath</key>
    <string>/tmp/chromadb.err</string>
</dict>
</plist>
EOF

# Load service
launchctl load ~/Library/LaunchAgents/com.chromadb.server.plist

# Verify
curl -s http://localhost:8000/api/v2/heartbeat

# Control
launchctl unload ~/Library/LaunchAgents/com.chromadb.server.plist  # stop
launchctl load ~/Library/LaunchAgents/com.chromadb.server.plist    # start
```

## Key Files

| File | Purpose |
|------|---------|
| `~/.chromadb/` | ChromaDB data directory |
| `~/Library/LaunchAgents/com.chromadb.server.plist` | Service config |
| `/tmp/chromadb.log` | Stdout log |
| `/tmp/chromadb.err` | Stderr log |

## Tags
`chromadb` `launchd` `macos` `vector-search` `infrastructure`
