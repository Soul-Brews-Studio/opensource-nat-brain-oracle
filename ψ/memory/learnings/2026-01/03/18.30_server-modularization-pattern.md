# Server Modularization Pattern

**Date**: 2026-01-03
**Context**: Refactoring a 1224-line monolithic server.ts into maintainable modules

## What We Learned

- Split by concern: types, db, logging, handlers, dashboard
- Keep main server.ts as thin HTTP routing layer only
- Export db connection from module for handlers to import
- Use `type Database` import to fix TypeScript export issues
- Tests remain compatible if they don't import from server.ts directly

## Why It Matters

- 75% reduction in main file size (1224 â†’ 305 lines)
- Each module has single responsibility
- Easier to test individual handlers
- New features go in appropriate module
- Code reviews focus on relevant changes only

## How To Apply

```typescript
// server/db.ts - Config + connection
export const db: DatabaseType = new Database(DB_PATH);
export function initLoggingTables() { ... }

// server/handlers.ts - Import db, export handlers
import { db } from './db.js';
export function handleSearch(...) { ... }

// server.ts - Just routing
import { handleSearch } from './server/handlers.js';
switch (pathname) {
  case '/search': result = handleSearch(...); break;
}
```

## Tags

`refactoring` `typescript` `modularization` `architecture` `server`
