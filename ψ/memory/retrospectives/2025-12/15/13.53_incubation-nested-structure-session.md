# Session Retrospective: Incubation Nested Structure

**Date**: 2025-12-15 (Monday)
**Time**: 13:22 - 13:53 (~31 minutes)
**Energy**: Medium

---

## What Happened

### Session Flow

1. **13:22** - Context restored from previous session (ghq+symlink pattern)
2. **13:25** - `/parallel` — asked about oracle-init for BACKSTAGE
3. **13:27** - Fixed `$ARGUMENTS` in 5 commands (draft, emotional, parallel, repo-scan, trace)
4. **13:28** - Discussed `/project incubate` with local path
5. **13:29** - Test failures — found wrong nested structure `ψ/incubate/repo/github.com/`
6. **13:31** - Wrongly copied oracle files into BACKSTAGE repo (mistake!)
7. **13:32** - User caught mistake! "we never clone to this repo we will ghq and symlink"
8. **13:33** - Cleaned up BACKSTAGE repo
9. **13:35** - Updated `/oracle-init` to embed content (no curl needed)
10. **13:38** - Found subagent created wrong nested structure again
11. **13:39** - Tried absolute paths ($ORACLE_ROOT) — too verbose
12. **13:43** - User insight: "we always incubate in oracle only" — relative paths OK!
13. **13:49** - User wanted nested structure like `~/Code/github.com/[org]/[repo]`
14. **13:50** - Restructured to nested format
15. **13:51** - Final test SUCCESS — mirrors ~/Code exactly!

---

## Key Achievements

### 1. Nested Structure (BIG WIN!)

**Before (flat):**
```
ψ/incubate/
├── backstage → ~/Code/.../backstage
├── esphome-fw → ~/Code/.../esphome-fw
```

**After (nested, mirrors ~/Code):**
```
ψ/incubate/github.com/
├── laris-co/
│   └── esphome-fw → ~/Code/github.com/laris-co/esphome-fw
└── Soul-Brews-Studio/
    └── backstage → ~/Code/github.com/Soul-Brews-Studio/backstage
```

### 2. $ARGUMENTS Fixed in 5 Commands

| Command | Added |
|---------|-------|
| `/draft` | `ARGUMENTS: $ARGUMENTS` |
| `/emotional` | `ARGUMENTS: $ARGUMENTS` |
| `/parallel` | `ARGUMENTS: $ARGUMENTS` |
| `/repo-scan` | `ARGUMENTS: $ARGUMENTS` |
| `/trace` | `ARGUMENTS: $ARGUMENTS` |

### 3. /oracle-init Embedded Content

**Before:** curl from GitHub (404 on private repos)
**After:** Content embedded in .md file — works offline!

### 4. Path Strategy Simplified

| Tried | Result |
|-------|--------|
| Absolute `$ORACLE_ROOT/ψ/...` | Too verbose, hardcoded |
| Relative `ψ/incubate/` | Works! (always from Oracle root) |

---

## Mistakes & Corrections

### Mistake 1: Copied files into BACKSTAGE repo
- **What**: Created `.claude/knowledge/` in BACKSTAGE repo
- **Why wrong**: Modifies external repo, not our pattern
- **Correction**: Cleaned up, use `/oracle-init` only when needed

### Mistake 2: Subagent created wrong structure
- **What**: `ψ/incubate/repo/github.com/...` instead of flat/nested
- **Why**: Subagent had different cwd
- **Correction**: Use relative paths from Oracle root

### Mistake 3: Over-engineered with $ORACLE_ROOT
- **What**: Added full absolute paths everywhere
- **Why wrong**: `/project` always runs from Oracle root
- **Correction**: Simple relative `ψ/incubate/github.com/$ORG/`

---

## Technical Decisions

| Decision | Why |
|----------|-----|
| Nested structure | Mirrors ~/Code, prevents name collision |
| Extract $ORG from URL | `sed 's\|.*/\([^/]*\)/[^/]*$\|\1\|'` |
| Relative paths | Always from Oracle root, simpler |
| Embedded /oracle-init | No network dependency |
| `unlink` not `rm` | Cleaner for symlinks |

---

## Files Changed

### Created
- `ψ/incubate/github.com/laris-co/` (structure)
- `ψ/incubate/github.com/Soul-Brews-Studio/` (structure)
- `ψ/memory/learnings/2025-12-15_project-command-patterns.md` (updated)

### Modified
- `.claude/commands/project.md` — nested structure
- `.claude/commands/draft.md` — $ARGUMENTS
- `.claude/commands/emotional.md` — $ARGUMENTS
- `.claude/commands/parallel.md` — $ARGUMENTS
- `.claude/commands/repo-scan.md` — $ARGUMENTS
- `.claude/commands/trace.md` — $ARGUMENTS
- `plugins/nat-data-personal/commands/oracle-init.md` — embedded content

### Cleaned Up
- Removed `.claude/` from BACKSTAGE repo
- Removed `ψ/incubate/repo/` wrong structure
- Moved flat symlinks to nested structure

---

## AI Diary

This session was a great example of iterative refinement with user feedback.

I made mistakes (copying files into external repo, over-engineering with absolute paths) but the user quickly corrected me with clear principles:
- "we never clone to this repo we will ghq and symlink"
- "we always incubate in oracle only"
- "it should be nested not flat... same as inside the ~/Code"

The final nested structure is elegant — it mirrors the ghq structure exactly, making it intuitive and preventing naming collisions.

The key insight: **simple relative paths work because /project only runs from Oracle root**. No need for complex $ORACLE_ROOT variables.

---

## Patterns Discovered

1. **Nested = Mirror ~/Code** — same structure everywhere
2. **Relative paths OK** — when command always runs from same root
3. **Embed content in .md** — no network dependency for init
4. **User corrections = gold** — listen to the pattern owner

---

## Commands Ready

```bash
# Incubate external repo (nested structure)
/project incubate https://github.com/org/repo

# Setup oracle in external repo
cd [repo] && /nat-data-personal:oracle-init

# Move between learn/incubate
/project learn [name]
/project incubate [name]
```

---

## Next Session

- [ ] Test `/oracle-init` in BACKSTAGE
- [ ] PITCH TODAY! (16 ธ.ค.)
- [ ] ส่งเบียร์

---

*Session: ~31 min | Focus: Infrastructure + Pattern Refinement*
*Energy: Started medium, ended satisfied*
