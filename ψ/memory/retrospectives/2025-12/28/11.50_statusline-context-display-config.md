# Retrospective: Status Line Context Display Configuration

**Date**: 2025-12-28 11:20-16:23
**Duration**: ~2 sessions (morning + afternoon)
**Focus**: Configure Claude Code status line for accurate context display

---

## What We Did

### Morning Session (11:20-12:40)

**The Problem**: Status line showing context usage needed refinement

**Iterations**:
1. `28% (43k)` → Added total: `28% (43k/200k)`
2. Debated reserved: 20% vs 22.5% vs fixed 20k vs 45k
3. Looked up Claude Code docs → confirmed **45k (22.5%) autocompact buffer**
4. Changed to percentage-based: `usable = size * 775 / 1000`

**Also Done**:
- Removed MCP tools from global `~/.claude/settings.json` → **43k tokens freed** (was 43k MCP, now 14k)
- Created minimal settings with only statusLine config
- Added agent color coding (main=cyan, agents 1-5 colored)
- Colored entire `[main*]` branch name
- Moved branch position: after time → back to after dir
- Researched 1M context → not available for Claude Max yet

### Afternoon Session (16:12-16:23)

- Moved `[main*]` back to after directory name
- Final format: `16:23 ~/Code/.../Nat-s-Agents [main*] • Opus 4.5 XX% (XXk/155k)`

---

## Final Status Line Format

```
16:23 ~/Code/.../Nat-s-Agents [main*] • Opus 4.5 97% (151k/155k)
      ^^^^^^^^^^^^^^^^^^^^^^^^^
      colored cyan for main agent
                                ^^^^^^
                                colored cyan
```

**Features**:
- Time first
- Directory with repo name colored by agent
- Branch colored by agent (entire `[main*]`)
- Model name
- Context: % of usable (used/usable)
- Scales for any context size (ready for 1M when available)

---

## What Worked

1. **Documentation lookup** - Used claude-code-guide subagent to find actual autocompact value (45k/22.5%)
2. **Iterative refinement** - Each version got closer to what user wanted
3. **Quick feedback loop** - User tested each change immediately
4. **MCP cleanup** - Removed unused tools, freed 29k tokens (43k → 14k)
5. **Percentage-based scaling** - Works for 200k now, ready for 1M later

---

## What Didn't Work

1. **Assumed wrong value** - Started with 20k, user said 20k, but docs say 45k
2. **Too many iterations** - Could have asked about format upfront
3. **Branch position flip-flop** - Moved to front, then back to after dir
4. **1M context unavailable** - Researched but can't use yet (Claude Max doesn't have access)

---

## AI Diary

This was an extended session spanning morning and afternoon - lots of small tweaks to get the status line exactly right. The iterative nature was interesting: we'd make a change, user would test, give feedback, and we'd adjust.

The most confusing moment was the reserved token debate. User initially said "20k" and I went with it, but then we looked up the docs and found it's actually 45k (22.5%). This taught me to always check documentation for system values rather than guessing or accepting rough approximations.

The MCP cleanup was a nice win - freeing up 29k tokens by removing unused Playwright tools makes a real difference. The status line now shows we're using 97% of usable context (151k/155k) which is much more informative than raw percentages.

The afternoon continuation was quick - just moving the branch position back where the user wanted it. Sometimes the first intuition was right.

---

## Honest Feedback

**What could have been clearer from the start**:
- The exact format wanted: time, dir, branch, model, context
- Whether reserved meant fixed amount or percentage
- Where the branch should be positioned

**What I should have done**:
- Looked up the autocompact docs earlier instead of accepting "20k"
- Asked about final layout before making changes

**Friction points**:
1. Multiple back-and-forth on percentage vs fixed reserved
2. File modified externally (user editing colors) caused Edit tool conflict once
3. Branch position changed twice

---

## Key Decisions

| Decision | Rationale |
|----------|-----------|
| 22.5% reserved (45k at 200k) | Claude Code docs: autocompact buffer |
| Percentage-based calculation | Scales for 1M context when available |
| Branch after directory | User preference, matches p10k style |
| Entire branch colored | Cleaner visual, not just the asterisk |
| Remove global MCP | 29k tokens wasted on unused Playwright |

---

## Files Changed (outside repo)

- `~/.claude/statusline-command.sh` - Complete rewrite of context display
- `~/.claude/settings.json` - Minimal config (statusLine only, no MCP)
- `~/.claude/settings.json.bak` - Backup of original with MCP

---

## Next Steps

- [ ] Monitor if 1M context becomes available for Claude Max
- [ ] Consider adding cost display to status line
- [ ] Document statusline customization in learnings

---

*Session: 2025-12-28 11:20-16:23*
*Track: statusline-config (ad-hoc)*
