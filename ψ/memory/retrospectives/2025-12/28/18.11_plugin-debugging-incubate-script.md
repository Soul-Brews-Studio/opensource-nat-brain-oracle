# Retrospective: Plugin Debugging + Incubate Script

**Date**: 2025-12-28 17:10-18:11
**Duration**: ~60 minutes
**Focus**: Debug plugin loading issue, create project-incubate.sh script

---

## What We Did

### 1. Plugin System Debugging
User reported `/plugin` showing "(no content)" in fitbit-analysis, but marketplace showed plugins available.

**Investigation path**:
1. Checked `~/.claude/plugins/installed_plugins.json` - found stale entries
2. Entries pointed to version `1.0.0` but cache only had `1.5.0`, `1.6.0`, `1.7.0`
3. Duplicate entries: `nat-agents-core@nat-plugins` AND `nat-agents-core@nat-agents-core`
4. Path mismatch = silent failure, no errors logged

**Root cause**: Registry → Cache path mismatch
- Registry said: `/cache/nat-plugins/nat-agents-core/1.0.0`
- Cache had: `/cache/nat-plugins/nat-agents-core/1.7.0`

**Fix**: Cleared installed_plugins.json, fresh install worked.

### 2. Created project-incubate.sh
Script handles:
- URL input: clone via ghq if needed, then symlink
- Path input: direct symlink
- Auto-registers slug in slugs.yaml
- Idempotent (checks before creating symlink/slug)

### 3. Updated /project Command
Added Scripts section referencing both scripts:
- `scripts/project-incubate.sh <url-or-path> [slug]`
- `scripts/project-create.sh <name> [--public]`

---

## What Worked

1. **Systematic tracing** - followed the plugin loading path methodically
2. **Script approach** - one bash call instead of multiple tool calls
3. **Testing the script** - removed symlink, ran script, verified output
4. **Multiple slugs = aliases** - same repo can have multiple entry points

---

## What Didn't Work

1. **Made two bash calls initially** - should have used combined command or script
2. **Tried several registry fixes** - took a few attempts to find the right approach
3. **Errors tab was empty** - plugin system fails silently on path mismatch

---

## AI Diary

This session was a detective story. The user showed me a screenshot of `/plugin` showing "(no content)" in one project but working in another. The clue was subtle - marketplace visible, but installed plugins not loading.

The investigation revealed how brittle the plugin system can be. A version mismatch in the registry (1.0.0 vs 1.7.0) caused complete silent failure. No errors, no warnings - just... nothing. The Errors tab was empty because the failure happened before the plugin even tried to load.

What struck me was the layered caching - old marketplace (`nat-plugins`), new marketplace (`nat-agents-core`), duplicate entries, version drift. Like geological strata of past installations.

The fix was satisfying though. Clear everything, fresh install, boom - works. Sometimes the cleanest solution is to start over.

The script work at the end felt like coming full circle. Last session created `project-create.sh`, this session created `project-incubate.sh`. One combined bash call instead of my earlier mistake of two separate calls. The user caught that immediately - "we have a script?"

---

## Honest Feedback

**What went well**:
- User provided clear screenshots showing the issue
- Tracing through the file structure was educational
- Script pattern is now established for /project commands

**Friction points**:
1. Plugin system lacks good error messages for path mismatches
2. Took multiple attempts to fix registry (tried updating paths before realizing fresh install was cleaner)
3. Forgot we had a script pattern from last session

**What I should have done differently**:
- Check for existing scripts first before doing manual work
- Try the nuclear option (clear + reinstall) earlier
- One combined bash call from the start

---

## Key Decisions

| Decision | Rationale |
|----------|-----------|
| Clear registry vs fix paths | Fresh install = known good state |
| Script vs inline bash | Reusable, documentable, one call |
| Multiple slugs OK | Aliases make lookup flexible |

---

## Files Changed

| File | Change |
|------|--------|
| `scripts/project-incubate.sh` | New - handles URL/path input |
| `.claude/commands/project.md` | Updated - added Scripts section |
| `ψ/memory/slugs.yaml` | Added mz-forwarder, 00_mz_forwarder |
| `~/.claude/plugins/installed_plugins.json` | Cleared and reinstalled (external) |

---

## External Changes

- Fixed: `~/.claude/plugins/installed_plugins.json` (cleared stale entries)
- Added symlink: `ψ/incubate/repo/github.com/laris-co/00_mz_forwarder`

---

## Lessons Learned

1. **Plugin registry is fragile** - version paths must exactly match cache
2. **Silent failures are hard** - no errors doesn't mean no problems
3. **Scripts over inline bash** - check for existing scripts first
4. **Fresh install > path fixes** - when registry is corrupted, start clean

---

## Next Steps

- [ ] Create `scripts/project-learn.sh` (similar to incubate)
- [ ] Consider adding plugin health check to startup
- [ ] Document plugin debugging in learnings/

---

*Session: 2025-12-28 17:10-18:11*
