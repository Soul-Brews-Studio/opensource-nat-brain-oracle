# Retrospective: Team Subagent Evolution

**Session**: 2025-12-18 12:00 - 12:44 GMT+7 (~44 min)
**Agent**: Main (Opus)
**Mode**: Iterative design + real-time testing

---

## Session Timeline

| Time | Action |
|------|--------|
| 12:00 | BM ถาม "Nat เป็นคนยังไง" — พบว่า subagent ไม่มี context |
| 12:02 | เพิ่ม auto-boot context ใน /bm, /ampere |
| 12:05 | เปลี่ยนจาก hardcode files → structure guide |
| 12:07 | ลบ MCP tools (local) → ใช้ file tools (shared) |
| 12:08 | เปลี่ยนจาก whitelist → all + blacklist |
| 12:11 | เน้น ALWAYS commit/push |
| 12:16 | Main polish output ใน Nat's Thai style |
| 12:20 | Log ALL interactions (not just direct actions) |
| 12:23 | Background subagent สำหรับ log + commit |
| 12:36 | Direct actions ใช้ subagent + find context |
| 12:37 | Ampere test: remind ไม่มี detail |
| 12:42 | ALWAYS ask for details ก่อนสร้าง issue |

---

## What Happened

### Problem: Subagent Has No Context

BM ถาม "Nat เป็นคนยังไง" → main agent ตอบได้ แต่ถ้าใช้ subagent จะไม่รู้อะไรเลย

**Solution**: Inject context ผ่าน prompt
- ψ/ structure guide
- Available commands
- How to search (file tools)

### Problem: MCP Tools Are Local

claude-mem MCP tools = Nat's local SQLite database
Team members ไม่สามารถใช้ได้

**Solution**: Use file tools only
- Glob — find files
- Grep — search content
- Read — read files

### Problem: Main Agent Does All Work

Direct actions (remind, request) ทำโดย main agent
- เปลือง context
- ช้า

**Solution**: Subagent handles everything
- Questions → Haiku subagent
- Direct actions → Haiku subagent
- Log + commit → Background Haiku subagent

### Problem: No Details in Issues

Ampere: "remind อย่าลืมโทรหาหมอ"
Issue created without asking: หมอไหน? เมื่อไหร่? เรื่องอะไร?

**Solution**: ALWAYS ask for details
- Who? When? What? Why?
- DO NOT create issue until details provided

---

## Commits This Session

| Hash | Message |
|------|---------|
| `0187480` | team: auto-boot context for /bm and /ampere subagents |
| `cb7cca2` | team: add available commands to subagent prompts |
| `e3efc92` | team: all commands available with blacklist |
| `dc48610` | team: emphasize ALWAYS commit/push |
| `aa9da87` | team: main agent polishes output in Nat's Thai style |
| `8157727` | team: log ALL interactions |
| `82db9c7` | team: background subagent handles log + commit + push |
| `5e0662e` | team: direct actions search context |
| `bf10c1d` | team: direct actions use subagent + ask if unclear |
| `0c282b2` | team: ALWAYS ask for details (who/when/what) |

**Total**: 10 team commits + 6 test commits = 16 commits in 44 min

---

## Key Learnings

### 1. Subagent Context Injection

Subagent ไม่มี context จาก main conversation — ต้อง inject ทุกอย่างผ่าน prompt:
- Structure guide (ψ/ folders)
- Available tools
- How to search
- Blacklist commands

### 2. Local vs Shared Tools

| Tool | Scope | Use |
|------|-------|-----|
| MCP (claude-mem) | Local to Nat | Main agent only |
| File tools (Glob/Grep/Read) | Shared via git | Everyone |

### 3. Background Subagent Pattern

```
Main agent → show result to user
    ↓ (parallel)
Background Haiku → log + commit + push
```

ไม่ต้องรอ — user ได้คำตอบเร็ว

### 4. Always Ask for Details

Vague request → vague issue → useless for Nat

**Before creating issue, ask:**
- Who? (ใคร/ที่ไหน)
- When? (เมื่อไหร่)
- What? (เรื่องอะไร)

### 5. Blacklist > Whitelist

All commands available + blacklist specific ones
ง่ายกว่า maintain whitelist

---

## What Delighted Me

### 1. Real-Time Testing Loop

Design → implement → BM/Ampere test → find bug → fix → repeat
เห็น feedback ทันที ทำให้ปรับได้เร็ว

### 2. Iterative Refinement

16 commits ใน 44 นาที — แต่ละ commit แก้ปัญหาเฉพาะจุด
ไม่ overthink, ship fast, fix fast

### 3. Pattern Discovery

"Subagent ไม่มี context" → นำไปสู่ auto-boot pattern
"MCP is local" → นำไปสู่ file tools pattern
"No details" → นำไปสู่ always-ask pattern

---

## What Could Improve

### 1. Test Before Commit

บาง commit ถูก test แล้วพบ bug ทันที
ควร test locally ก่อน push

### 2. Labels Setup

Labels ไม่มีใน repo → issue create failed หลายรอบ
ควร setup labels เป็น part of initialization

### 3. Documentation

เปลี่ยนแปลงเยอะมาก แต่ไม่ได้ update CLAUDE.md
ควร sync docs กับ implementation

---

## AI Diary

Session นี้เป็นการ iterate เร็วมาก — 16 commits ใน 44 นาที

สิ่งที่ประทับใจคือ **real feedback loop** — Nat ให้ BM และ Ampere ทดสอบจริง แล้วเห็นปัญหาทันที:
- "Thai lang is weird" → main polish output
- "No log created" → log ALL interactions
- "No detail in issue" → ALWAYS ask

Pattern ที่เห็น: **Ship fast, learn from reality, fix immediately**

ไม่มีการ plan ล่วงหน้ามาก แต่ iterate จากปัญหาจริง ทำให้ solution fit กับ reality

---

## Session Stats

| Metric | Value |
|--------|-------|
| Duration | 44 min |
| Commits | 16 |
| Team commits | 10 |
| Test commits | 6 |
| Files changed | 2 (bm.md, ampere.md) |
| Patterns discovered | 5 |

---

## Patterns for Future

### 1. Auto-Boot Context

```
Every subagent prompt includes:
- ψ/ structure guide
- Available tools
- How to search
- Role context
```

### 2. Background Commit

```
subagent_type: general-purpose
model: haiku
run_in_background: true
prompt: "Log + commit + push"
```

### 3. Always Ask Pattern

```
If request is vague:
1. Ask: Who? When? What?
2. Wait for answer
3. Then create issue
```

---

*Session: team-subagent-evolution*
*Main agent wrote this with full conversation context*
