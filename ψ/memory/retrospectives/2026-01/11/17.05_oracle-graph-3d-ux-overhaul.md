# Session Retrospective: Oracle Graph 3D UX Overhaul

**Date**: 2026-01-11 17:05 (Sunday)
**Duration**: ~25 minutes (16:44 - 17:05)
**Primary Focus**: Transform Knowledge Graph from spider web to interactive 3D visualization

---

## Summary

Iterative UX session responding to real-time feedback. Converted dense 27k-link spider web into clean, animated graph with hover-to-reveal connections, ambient highlights, and HUD controls.

---

## What Happened

### Phase 1: Initial Assessment (16:44-16:47)
- `/recap` revealed Graph page already uses Three.js + KlakMath
- User asked: "is it real 3D? can we zoom? show node detail on hover?"
- Found: Real 3D (Three.js), zoom works (OrbitControls), but `hoveredNode` state unused

### Phase 2: Hover + Tooltip (16:47-16:52)
1. Added raycasting for hover detection
2. Created tooltip showing type + filename + concepts
3. Fixed Node interface to include `source_file` and `concepts[]`
4. Made file path clickable to view full content (then simplified to "Search related" link)

### Phase 3: Spider Web Problem (16:55-16:57)
- User feedback: "too spiderly feel too much spider web"
- Solution: Only show connections on hover (not all 27k links at once)
- Added link index for O(1) lookup of node connections

### Phase 4: Ambient Animation (16:57-16:58)
- User wanted: "slow animation to show points can have connection"
- Added ambient mode: cycles through random nodes every 2 seconds, shows 5 connections
- Shows graph is alive without overwhelming

### Phase 5: Visibility + Controls (16:58-17:02)
- User feedback: "dark in the dark is too dark!"
- Brightened lines: white color, 0.9 opacity for active, 0.6 for ambient
- Changed canvas bg to #12121a (slightly lighter than page)
- Added HUD: rotate toggle, reset view, zoom +/-

### Phase 6: State Persistence (17:02-17:05)
- User wanted: "when click it show hold the state and lines"
- Added `selectedIdRef` to persist selection across renders
- Freeze animation when hovering or selected
- Lines stay visible for selected node

---

## Technical Changes

**Graph.tsx** (~100 lines changed):
- Hover detection with raycaster
- Dynamic line system (max 100 lines, only show relevant)
- Link index map for fast connection lookup
- Ambient animation timer
- Animation freeze on hover/select
- selectedIdRef for state persistence

**Graph.module.css** (~80 lines added):
- Tooltip styles with backdrop blur
- HUD button styles
- graphContainer for relative positioning
- Type-based tooltip colors

---

## AI Diary

This was pure flow state. User gave rapid feedback, I responded immediately. No overthinking, no planning docs - just build, show, adjust.

The "spider web" moment was key. 27k links looked impressive in stats but terrible visually. The fix was simple: don't show everything. Show what matters. Hover reveals connections. Ambient animation hints at depth without overwhelming.

The "dark in the dark" feedback taught me about contrast. I kept defaulting to subtle (0.15 opacity, muted purple). User wanted visible. Sometimes "cool" means bright and clear, not subtle and mysterious.

The state persistence bug was classic React closure trap. Local variable `currentSelectedId` in useEffect doesn't update when React state changes. Fixed with ref that syncs via useEffect. Should've done this from the start.

---

## Honest Feedback

### What Worked
- **Rapid iteration**: Build → feedback → adjust loop every 2-3 minutes
- **Minimal viable changes**: Each edit was focused, not over-engineered
- **Real-time testing**: Browser automation let us see results immediately

### Friction Points
1. **Closure trap**: Spent time debugging why click didn't persist - classic useEffect closure issue
2. **Contrast assumptions**: Kept defaulting to "subtle" when user wanted "visible"
3. **Interruptions**: User interrupted multiple times mid-typing - should watch for signals faster

### Lessons
- When user says "dark" - go bright, not slightly less dark
- React state in animation loops = use refs
- "Cool" often means "clear and responsive" not "subtle and minimal"

---

## Communication Dynamics

| Feedback | My First Response | Correct Response | Gap |
|----------|-------------------|------------------|-----|
| "too spiderly" | Reduce line opacity | Only show hover connections | Medium |
| "dark in the dark" | Increase to 0.4 opacity | Use white at 0.9 | High |
| "hold the state" | Use local variable | Use ref synced to state | Medium |

User communicates in bursts. When they interrupt, it means current approach isn't landing. Should treat interrupts as strong signal to pivot.

---

## Co-Creation Map

| Aspect | Nat | Claude | Note |
|--------|-----|--------|------|
| Direction | 95% | 5% | Nat drove every feature decision |
| Technical | 10% | 90% | I implemented all code |
| UX judgment | 80% | 20% | Nat caught all visibility issues |
| Iteration speed | 50% | 50% | Both pushed for rapid cycles |

---

## Artifacts

**Files Modified** (oracle-v2 repo):
- `frontend/src/pages/Graph.tsx`
- `frontend/src/pages/Graph.module.css`

**Not Committed Yet** - changes are local only

---

## Session Rating: 8/10

- Excellent iteration speed
- Good feature delivery (hover, tooltip, HUD, ambient)
- Lost points on contrast judgment (took 3 tries)
- Lost points on state persistence bug

---

## Next Actions

1. Test click-to-hold state works correctly
2. Verify all HUD buttons function
3. Commit changes to oracle-v2
4. Push pending commit c464ff7 from last session

---

*Generated by Claude Opus 4.5 at 17:05*
