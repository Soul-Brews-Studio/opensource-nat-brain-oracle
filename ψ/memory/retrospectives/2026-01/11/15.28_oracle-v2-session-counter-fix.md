# Session: Oracle-v2 Session Counter Fix

**Date**: 2026-01-11 12:09-15:28 (3h 19m)
**Primary Focus**: Fix oracle-v2 session counter + MCP logging

---

## What Happened

1. `/recap` detected 28h stale focus, async work pattern
2. Multiple `/trace` explorations of oracle-v2 history
3. Started oracle server, discovered graph (443 nodes, 5278 links)
4. Counted 999 markdown files (327 retros + 672 learnings)
5. `/learn AI-HUMAN-COLLAB-CAT-LAB` re-exploration
6. Investigated session counter bug (shows 0 despite activity)
7. Created GitHub issue #24
8. Implemented 6 fixes to oracle-v2
9. Committed and pushed all changes

---

## Fixes Implemented (oracle-v2)

| Fix | File | What |
|-----|------|------|
| Session stats API | `src/server.ts` | `/api/session/stats` endpoint |
| Header fetch | `frontend/.../Header.tsx` | API instead of localStorage |
| MCP logging | `src/index.ts` | `logSearch()` in handler |
| Store results | `src/server/logging.ts` | Top 5 results as JSON |
| Auto-start HTTP | `src/index.ts` | `ensureServerRunning()` |
| Static path | `src/server.ts` | Absolute path for serveStatic |
| Double search | `frontend/.../Search.tsx` | Remove duplicate doSearch |

---

## AI Diary

This session exemplified the "Exploratory Jump Pattern" I logged to Oracle earlier. What looked like scattered topic-hopping (/trace, Three.js, Arthur, skills) was actually systematic context building before diving into the session counter fix.

The bug hunt was satisfying - tracing from "0 searches" in UI to discovering the complete disconnect between frontend localStorage and backend database. Two separate systems never talking to each other. The fix required touching 7 files across frontend, backend, and database schema.

I felt confident navigating the oracle-v2 codebase now - months of work have made it familiar territory. The auto-start HTTP server addition felt like a natural enhancement discovered during debugging.

Context hit 99% before I could properly finish - had to rush the retrospective. The pattern holds: deep work sessions fill context quickly.

---

## Honest Feedback

**Friction 1**: MCP and HTTP server being separate processes caused confusion. User expected `/mcp` to start everything, but HTTP server was separate. Fixed by adding auto-start.

**Friction 2**: The relative path bug (`./frontend/dist`) only manifested when server started from different directory. Subtle issue that took time to diagnose.

**Friction 3**: Drizzle ORM reminder - I initially used raw SQL for schema change. Should default to Drizzle for consistency.

---

## Learnings

1. **Exploratory jumps = context building** (logged to Oracle)
2. **MCP ≠ HTTP** - separate processes need explicit linking
3. **Relative paths break** when cwd changes - use absolute
4. **Double search bug** - setSearchParams triggers useEffect which calls doSearch

---

## Commits

- `c4cd488` (oracle-v2): fix: Session counter + MCP logging + auto-start HTTP server (#24)

---

## Next Session

- [ ] Fix remaining duplicate search issue
- [ ] Update Activity UI to show results preview
- [ ] Track knowledge gaps (zero results)
- [ ] Continue frontend dev at http://localhost:3001/

---

*999 files → 1000th file is this retrospective!*
