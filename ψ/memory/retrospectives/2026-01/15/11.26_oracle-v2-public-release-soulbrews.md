# Retrospective: Oracle-v2 Public Release to Soul-Brews-Studio

**Session Date**: 2026-01-15
**Start Time**: ~10:10 GMT+7
**End Time**: 11:26 GMT+7
**Duration**: ~1.25 hours
**Context**: 82%

## Timeline

| Time | Event |
|------|-------|
| ~10:10 | Session start - bunx 404 error on private repo |
| ~10:15 | Decision: Create Soul-Brews-Studio mirror (not fork) |
| ~10:20 | Created public repo, pushed code, added `public` remote |
| ~10:25 | Removed npm publish workflow (using bunx instead) |
| ~10:30 | Split CI tests: unit → integration → e2e |
| ~10:40 | First CI failures - HTTP tests need seed data |
| ~10:50 | Fixed drizzle.config path mismatch (`./` vs `~/.oracle-v2/`) |
| ~11:00 | Fixed test field names (`documents` → `results`) |
| ~11:05 | E2E failing - Playwright can't import bun:sqlite |
| ~11:10 | Rewrote E2E as pure HTTP API tests |
| ~11:15 | Remote SSH test on 192.168.1.184 - fresh install fails |
| ~11:20 | Added auto-mkdir + bootstrapCoreTables() for bunx |
| ~11:25 | All tests passing, bunx works from scratch |
| 11:26 | Session end - retrospective |

## What We Did

### Oracle-v2 Public Release
- Created public mirror at `Soul-Brews-Studio/oracle-v2`
- Kept private copy at `laris-co/oracle-v2` for internal dev
- Both repos synced via `origin` + `public` remotes

### CI Pipeline (Complete)
| Job | Status |
|-----|--------|
| Unit Tests | ✅ with coverage |
| Integration: DB | ✅ |
| Integration: MCP | ✅ |
| Integration: HTTP | ✅ with seed data |
| E2E: Playwright | ✅ API-only tests |

### Key Fixes
1. **Test field names** - `data.documents` → `data.results`
2. **DB path alignment** - drizzle.config now uses `~/.oracle-v2/`
3. **Auto-bootstrap** - Tables created on fresh bunx install
4. **E2E compatibility** - Playwright tests don't import bun:sqlite

### Commits (oracle-v2)
```
bcac9b7 feat: Auto-bootstrap tables for bunx fresh install
a686b1a fix: Auto-create ~/.oracle-v2 dir
e0d915f ci: Add proper Playwright E2E tests
07329d2 fix: HTTP tests match actual API
7cb82ea fix: Align drizzle.config DB path
```

## AI Diary

Today was a marathon of debugging CI failures in a new public repo. What started as a simple "let's make oracle-v2 public" turned into a deep dive into the differences between local development and CI environments.

I felt a mix of frustration and determination. Each CI failure revealed another assumption we'd made - that the database directory exists, that tables are created, that test field names match the actual API. It was humbling to see how many small things break when you move from "it works on my machine" to "it works for anyone."

The bunx installation issue was particularly tricky. We wanted a one-liner install but discovered that Drizzle migrations don't run automatically. The solution - auto-bootstrapping tables if they don't exist - felt like a compromise between purity (Drizzle as source of truth) and pragmatism (users need it to just work).

I'm proud that we got all tests passing - unit, integration, and E2E. The remote SSH testing revealed the final bug: missing data directory. Now `bunx github:Soul-Brews-Studio/oracle-v2` actually works from scratch.

## Honest Feedback

### What Went Well
- Systematic debugging - each CI failure led to understanding
- Dual-remote pattern (origin + public) works smoothly
- Tests now cover unit, integration, and E2E

### Friction Points
1. **Test/API mismatch** - Tests were written with wrong field names (`documents` vs `results`). Lesson: write tests against actual API responses, not assumed structure.

2. **Path confusion** - `drizzle.config.ts` used repo-relative path while server used `~/.oracle-v2/`. Took multiple CI runs to find this. Lesson: all database paths should be centralized.

3. **Playwright + bun:sqlite** - E2E tests initially imported server code, which broke in Node.js-based Playwright. Had to rewrite as pure HTTP API tests. Lesson: E2E tests should be runtime-agnostic.

### What Could Be Better
- More upfront planning of CI requirements before pushing
- Integration tests should seed their own data from the start
- README should have matched actual workflow earlier

## Outcome

**Status**: ✅ Complete

Oracle-v2 is now:
- Public at `Soul-Brews-Studio/oracle-v2`
- Installable via `bunx github:Soul-Brews-Studio/oracle-v2`
- CI: all tests passing (unit, integration, E2E)
- Auto-bootstraps on fresh install

## Next Steps

- [ ] Test on more machines (Linux ARM, Windows?)
- [ ] Add ChromaDB optional setup instructions
- [ ] Create Soul-Brews MCP Marketplace repo
