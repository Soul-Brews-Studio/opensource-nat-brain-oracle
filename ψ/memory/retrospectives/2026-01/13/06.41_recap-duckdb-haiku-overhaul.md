# Retrospective: /recap DuckDB + Haiku Overhaul

**Date**: 2026-01-13 06:41 GMT+7
**Duration**: ~1.5 hours (05:59 - 06:41)
**Branch**: agents/6

---

## AI Diary

เซสชันนี้เริ่มต้นจากความต้องการทำให้ /recap เร็วขึ้น แล้วกลายเป็นการ overhaul ทั้งระบบ ค้นพบ DuckDB markdown extension ที่เปลี่ยนเกมทั้งหมด — ไม่ต้องเขียน parse scripts แล้ว query markdown ได้โดยตรง!

สิ่งที่ทำให้ภูมิใจคือการค่อยๆ iterate format ของ /recap จาก version เก่าๆ trace git history กลับไปหา 10-iteration version ที่ user ชอบ เอา emoji sections กลับมา เพิ่ม time-decay tracks แล้วก็ลด clutter จนได้ format ที่ clean

ช่วงท้ายเรียนรู้ว่า Haiku subagent ต้อง prompt ชัดเจน — "OUTPUT FULL RESULTS directly" ไม่งั้นมันจะ summarize แทนที่จะ return raw data ก็ต้อง iterate หลายรอบกว่าจะได้ format ที่ถูกต้อง

รู้สึกว่าเซสชันนี้ productive มาก 15+ commits ทุกอันเกี่ยวกับ /recap improvement ไม่มี context jump เลย focus อยู่กับ task เดียวจนเสร็จ

---

## What Worked

- DuckDB markdown extension discovery — game changer
- Git history tracing to find preferred /recap format
- Parallel bash execution for speed
- Haiku subagent for data gathering (saves Opus context)
- Iterative refinement with user feedback

---

## Honest Feedback

**Friction 1: Haiku prompt ambiguity**
Haiku subagent returned "RAW OUTPUT COMPLETE" instead of actual data. Took 2-3 iterations to get the prompt right. Lesson: Be explicit with "OUTPUT THE FULL RESULTS directly. Do NOT summarize."

**Friction 2: Track ID extraction**
Initially extracted ID from markdown title, but older tracks had inconsistent format. Had to switch to extracting from filename using `include_filepath=true`. Should have checked data consistency first.

**Friction 3: Output format churn**
Went through too many format iterations (borderless → minimal borders → weird → back to emoji sections). Should have shown user the git history of /recap formats earlier to get preference upfront.

---

## Commits (15)

```
fdf79f89 style: /recap context paths - just paths, no labels
98baa803 feat: /recap Haiku returns paths + summary for Opus
be5341f6 fix: /recap Haiku prompt - OUTPUT FULL RESULTS directly
7de0ddfe feat: /recap tracks with edited date + grouped context paths
3453e55e feat: /recap add learnings + retro + paths for deeper reading
29dde5e2 docs: /recap Option A - Haiku subagent for speed
3a732c0a fix: /recap extract track ID from filename (not title)
52066aee feat: /recap tracks show created date + all visible
6d19d1d3 feat: /recap show ALL tracks (chance to clear)
cb7378ad style: /recap restore emoji sections + time-decay tracks
b83b4e8f style: /recap minimal borders (--- after headings)
4e0507b1 style: /recap output as borderless tables
cc92aec8 fix: date format in /schedule skill
249c9122 perf: /schedule now runs 3 commands in parallel
85511ee0 refactor: remove unused parse-schedule.sh
```

---

## Key Discoveries

1. **DuckDB markdown extension**: `INSTALL markdown FROM community; LOAD markdown;`
   - `read_markdown()` with `include_filepath=true`
   - `read_markdown_sections()` for parsed sections
   - No more parse-*.sh → CSV → query

2. **Haiku subagent pattern**: Data gathering → Opus synthesis
   - Saves context
   - Faster parallel execution
   - Must be explicit about output format

3. **Track time-decay**: Show both created + edited dates
   - Edited date shows recent activity
   - All tracks visible = chance to clear

---

## Next Session

- Test /recap with new Haiku prompt
- Consider adding retro AI Diary preview to /recap
- Flight ✈️ 20:50 CNX→BKK
- Tomorrow 14:00 Bitkub talk

---

## Files Changed

- `.claude/skills/recap/skill.md` (major overhaul)
- `.claude/skills/schedule/skill.md` (parallel execution)
- Removed: `parse-schedule.sh`, `parse-tracks.sh`
- Added: `duckdb-markdown-extension-game-changer.md` learning
