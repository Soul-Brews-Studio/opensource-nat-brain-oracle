# Retrospective: DuckDB Schedule Skill + Three Patterns

**Date**: 2026-01-13 07:47 - 08:08 (~21 minutes)
**Branch**: agents/6
**Context Usage**: Started at 30% → ended at 71%
**Previous Session**: skill-refactor-progressive-disclosure (06:42-07:41)

---

## What We Did

### 1. Logged Bitkub Relationship History
- Created `ψ/memory/logs/info/2026-01-13_07-48_bitkub-relationship-history.md`
- Full timeline: พี่อาร์ม (2022) → พี่ต้น (2025) → Bitkub meetings (2026)
- Three chats consolidated chronologically

### 2. Updated Schedule
- Added Jan 15 Wed 14:00 Bitkub follow-up meeting
- Fixed TODAY marker (was stuck on Jan 11)
- Added prep notes for Bitkub talk

### 3. Created `/schedule` Skill
**The main deliverable** — new skill following progressive disclosure pattern:

```
.claude/skills/schedule/
├── skill.md              # Lean docs
└── scripts/
    ├── query.sh          # DuckDB markdown queries
    ├── test.sh           # Bash tests (6 cases)
    └── schedule.test.ts  # Bun tests (6 cases)
```

Key discovery: `regexp_extract_all()` for filtering table rows:
```sql
SELECT regexp_extract_all(content, '\|[^\n]*Jan 13[^\n]*\|')
FROM read_markdown_sections('schedule.md');
```

### 4. Added Data Query Patterns to CLAUDE_lessons.md
```
| Data Source | Query Method |
|-------------|--------------|
| GitHub CSV | gh api | duckdb |
| Markdown tables | DuckDB markdown |
| Oracle knowledge | Oracle MCP tools |
| SQLite databases | NEVER direct |
```

### 5. Documented Three Patterns to Oracle
1. `learning_2026-01-13_duckdb-markdown-pattern-the-parser-eliminatio.md`
2. `learning_2026-01-13_github-api-duckdb-pattern-gh-api-duckdb.md`
3. Trace logged: `c7ef9bb8-cba7-42a5-be5d-244cef622f62`

### 6. Created Writing
- **Blog**: `ψ/writing/2026-01-13_duckdb-markdown-skill-pattern.md` (~220 lines)
- **Book**: `ψ/writing/book-duckdb-markdown-revolution.md` (~400 lines, 5 chapters)

---

## AI Diary

This session felt like a crystallization moment. The previous session discovered the DuckDB markdown extension. This session took that discovery and:

1. **Applied it** — created a working `/schedule` skill
2. **Tested it** — both bash and Bun tests, all passing
3. **Documented it** — three patterns logged to Oracle
4. **Narrated it** — blog post and full book written

The user kept pushing for more: "and /physical?" — reminding me that the `gh api | duckdb` pattern is equally important. Good catch. The three patterns form a complete data query toolkit:

| Pattern | When |
|---------|------|
| `gh api \| duckdb` | GitHub-hosted data |
| `read_markdown_sections()` | Local markdown |
| `regexp_extract_all()` | Table row filtering |

The book's key insight resonates: *"The tools we build reveal the tools we're missing."* We built parsers because we didn't know about the extension. Now we know.

---

## Honest Feedback

**What worked:**
- Learning from /recap → immediate application to /schedule
- Dual testing (bash + Bun) caught path issues early
- User's "forgot about /physical?" kept the picture complete
- Oracle trace preserved the discovery for future sessions

**What didn't:**
- Initially tried to query SQLite directly (user corrected: use MCP)
- `read_markdown_blocks()` doesn't exist — had to use `read_markdown_sections()`
- Bun test path resolution needed `$.cwd()` fix

**Pattern discovered:**
- `regexp_extract_all()` is the key to filtering markdown tables
- `(?i)` prefix for case-insensitive regex in DuckDB
- Skill structure: `skill.md` + `scripts/` with tests

---

## Key Learnings

1. **regexp_extract_all()** — Extract specific rows from markdown tables
2. **Three patterns** — gh api|duckdb, read_markdown_sections, regexp_extract_all
3. **Always test** — Bun + bash catches different issues
4. **Oracle everything** — Trace, learn, search later

---

## Session Stats

| Metric | Value |
|--------|-------|
| Duration | ~21 minutes |
| Context | 30% → 71% |
| New files | 8 |
| Oracle learnings | 2 |
| Tests written | 12 (6 bash + 6 Bun) |
| Blog lines | ~220 |
| Book lines | ~400 |

---

## Files Created/Modified

**New:**
- `.claude/skills/schedule/scripts/query.sh`
- `.claude/skills/schedule/scripts/test.sh`
- `.claude/skills/schedule/scripts/schedule.test.ts`
- `ψ/writing/2026-01-13_duckdb-markdown-skill-pattern.md`
- `ψ/writing/book-duckdb-markdown-revolution.md`
- `ψ/memory/logs/info/2026-01-13_07-48_bitkub-relationship-history.md`
- `ψ/memory/learnings/2026-01-13_duckdb-markdown-pattern-*.md`
- `ψ/memory/learnings/2026-01-13_github-api-duckdb-pattern-*.md`

**Modified:**
- `ψ/inbox/schedule.md` — Added Jan 15, fixed TODAY
- `CLAUDE_lessons.md` — Added data query patterns
- `.claude/skills/schedule/skill.md` — Updated docs

---

## Next Session

- Commit all new files
- Test `/schedule` in fresh context
- Flight tonight 20:50 CNX→BKK
- Bitkub talk tomorrow 14:00 (slides + Arthur demo)

---

## Meta

This retrospective documents a **crystallization session** — taking a raw discovery (DuckDB markdown extension) and transforming it into:
- Working code (skill)
- Tests (bash + Bun)
- Documentation (Oracle)
- Narrative (blog + book)

The pattern: **Discover → Apply → Test → Document → Narrate**
