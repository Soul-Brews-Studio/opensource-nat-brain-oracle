# Session Retrospective

**Date**: 2026-01-08
**Time**: 07:26 - 08:21
**Duration**: ~55 minutes
**Focus**: Project Manager Skill Enhancement + Parser Bug Fix

---

## Summary

Extended project-manager skill with `/project search` and `/project index` commands, then spent significant time debugging Claude Code's skill parser error (`$.description.split is not a function`).

---

## What We Built

### 1. `/project search` Command
- Search repos locally (ghq) first, then GitHub API fallback
- Clean output: just paths, cmd+clickable
- Aliases: `search` and `find` both work
- Auto-triggers on "find repo", "search repos", "where is [project]"

### 2. `/project index` Command
- Lists manifests from reunion
- Groups output: Indexable (has ψ/) vs Skip (no ψ/)
- Smart filtering:
  - Our orgs (dynamic from gh api): ψ/ + legacy patterns
  - External: only ψ/
- Shows clickable local paths

---

## What We Fixed

### Parser Bug: `$.description.split is not a function`

**Symptom**: Error when typing `/` + characters for autocomplete

**Root Cause**: Skill/command files without YAML frontmatter

**Files Fixed**:
1. `.claude/skills/**/*.md` - Added frontmatter to all
2. `.claude/commands/*.md` - Added frontmatter to 45 files
3. `~/.claude/commands/merged.md` - Global command
4. `~/.claude/skills/session-uuid/skill.md` - Global skill
5. `~/.claude/skills/oracle-query/skill.md` - Global skill
6. `~/.claude/skills/mem-search/operations/*.md` - Plugin files
7. Removed old `claude-mem v7.3.3` cache

**Learning**: All `.md` files in `.claude/skills/` and `.claude/commands/` need YAML frontmatter with `name` and `description` fields.

---

## Commits (20)

| Type | Description |
|------|-------------|
| feat | `/project search` + `/project index` commands |
| feat | Dynamic orgs from gh api |
| feat | Legacy patterns for our orgs |
| fix | Parser fixes (frontmatter for all files) |
| fix | Output formatting (clickable paths) |
| docs | Search/find aliases |
| refactor | Simple ψ/*.md filter |

---

## Learnings to Oracle

1. **Command Naming: Easy to Type**
   - Frequent (10x/day): short codes OK (`rrr`, `ccc`)
   - Occasional: readable words (`/project search`)

2. **Command Naming: Balance Typing + Reading**
   - Eye-brain scanning > keystroke count for infrequent commands

3. **Skill Parser: Single-line Description Only**
   - Multi-line `description: |` breaks parser
   - Error: `$.description.split is not a function`

---

## What Didn't Work

- Parser error persisted even after many fixes
- Turned out to be combination of:
  - Project skill files
  - Project command files
  - Global `~/.claude/` skill files
  - Old plugin cache (claude-mem v7.3.3)
- Still getting error on autocomplete (possible Claude Code bug)

---

## AI Diary

Interesting debugging session. The parser error was frustrating because it kept appearing even after fixing obvious issues. The pattern of "fix one, find another" repeated many times.

Key insight: Claude Code scans ALL `.md` files in skills/commands folders, not just top-level ones. So nested files like `references/prompt-patterns.md` or plugin operation files also need frontmatter.

The user was patient and methodical, suggesting to disable plugins and clear cache when file fixes didn't work.

---

## Next Steps

- [ ] Report parser bug to Claude Code team (error during autocomplete)
- [ ] Implement actual `oracle_learn` calls in `/project index`
- [ ] Consider `/project sync` command

---

## Stats

- Files changed: ~60+
- Commands added: 2
- Parser fixes: 50+ files
- Oracle learnings: 3
