# Retrospective: Meshtastic Flash + tmux Skill Refinement

**Date**: 2026-01-12 20:44
**Duration**: ~1 hour (19:40 - 20:44)
**Context**: 94% at end

---

## AI Diary

This session was a journey of debugging, discovery, and skill refinement.

Started with what seemed simple: "flash Meshtastic". But reality had other plans. The ESP32-S3 board kept boot-looping. I made assumptions about hardware specs (4MB flash, no PSRAM) that turned out wrong. esptool revealed the truth: **4MB flash + 2MB PSRAM**.

The real breakthrough came when Nat pointed to an existing working variant: `custom_sx1280_board_s3`. I had been creating new configs when the answer was already there. Lesson: **search before creating**.

The USB mode setting (`ARDUINO_USB_MODE=1` vs `0`) was the silent killer. Wrong setting = device freezes on serial connect. No error, just frozen. Hours could be lost to this.

The tmux skill refinement was satisfying. The original pattern of running commands directly meant sessions died when commands finished. Nat's insight: "start with name then call command" - persistent bash shell first, then send commands. Simple but transformative.

Testing the refined skill end-to-end with meshtastic proved the pattern works. Fire session, send commands, interrupt with C-c, send more commands, kill when done. The session persists.

---

## What Worked

| Action | Why It Worked |
|--------|---------------|
| Using existing `custom_sx1280_board` variant | Already had correct pins and USB settings |
| Direct esptool instead of pio upload | Bypassed freeze issue, gave clear output |
| `--flash_size detect` flag | Let esptool auto-detect actual hardware |
| Auto-detect C-c in send.sh | Regex `^C-[a-z]$` cleanly handles special keys |
| capture-pane over log files | More reliable for interactive sessions |
| Full workflow proof test | Verified all scripts work together |

## What Didn't Work

| Issue | Root Cause | Fix |
|-------|------------|-----|
| Boot loop after flash | 8MB flash assumed, board has 4MB | Use correct board definition |
| pio upload freezing | Unknown - possibly USB mode | Use esptool directly |
| PSRAM error on boot | Built with PSRAM flag, board has different PSRAM | Correct board definition |
| send.sh C-c as text | Always added Enter after keys | Auto-detect special keys |
| check.sh stale output | Log file not updated for interactive sessions | Use capture-pane |
| Session dies after command | tmux ran command directly | Persistent bash shell first |

## Technical Details

### Hardware Discovery
```
Chip: ESP32-S3 (QFN56) revision v0.2
Flash: 4MB (auto-detected)
PSRAM: 2MB (Embedded AP_3v3)
USB: USB-Serial/JTAG
```

### Working Meshtastic Config
- Variant: `custom_sx1280_board_s3`
- Firmware: 2.7.18.5ce821c
- LoRa: SX1280 2.4GHz (LORA_24)
- GPS: Pins 41/42/47 configured

### tmux Skill Scripts Modified
1. **run.sh** - Persistent bash session
2. **send.sh** - Auto-detect C-c/C-d
3. **check.sh** - Use capture-pane
4. **skill.md** - Updated documentation

---

## Honest Feedback

**What I should have done differently:**
- Searched for existing variants FIRST before creating new ones
- Read the docs about Meshtastic minimum requirements earlier
- Tested esptool directly when pio upload froze instead of retrying

**What Nat taught me:**
- "search before creating" - existing solutions often exist
- "persistent shell first" - the tmux pattern insight
- "uvx instead of installed CLI" - fresh environment each time

**Skills demonstrated:**
- Debugging boot loops via serial output
- Hardware discovery with esptool
- Skill refinement based on usage feedback
- End-to-end testing to prove fixes work

---

## Learnings Logged to Oracle

1. `2026-01-12_meshtastic-esp32-s3-sx1280-setup-pattern-h.md`
2. `2026-01-12_tmux-skill-pattern-persistent-sessions-key.md`

---

## Next Session

- [ ] Test GPS outdoors for satellite lock
- [ ] Test LoRa communication between devices
- [ ] Clean up auto-handoff files (11 untracked)
- [ ] Consider merging agents/6 to main

---

## Session Stats

| Metric | Value |
|--------|-------|
| Commands executed | ~60 |
| Files modified | 4 (tmux scripts + skill.md) |
| Learnings logged | 2 |
| Devices configured | 1 (Meshtastic 5c4c) |
| Skills refined | 1 (/tmux) |
| Flash attempts | ~5 |
| Boot loops debugged | 3 |

---

*Context at 94% - good session length*
