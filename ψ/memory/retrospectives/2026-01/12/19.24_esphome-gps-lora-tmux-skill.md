# Session Retrospective: ESPHome GPS/LoRa + tmux Skill

**Date**: 2026-01-12 19:24
**Duration**: ~2.5 hours (17:00-19:24, post-compact session)
**Theme**: Hardware debugging + skill creation
**Branch**: agents/6

---

## What We Did

### 1. ESPHome GPS Testing on white.local
- Created gps-test.yaml with pins TX:41, RX:42, Power:47
- Initially only received `\x00` - no NMEA data
- Tried multiple configs: power cycling, baud rate changes
- **BREAKTHROUGH**: User's config with TX/RX swapped + ALWAYS_ON power worked!
- GPS now streaming NMEA: `$GNGGA`, `$GNRMC`, `ANTENNA OK`

### 2. ESPHome LoRa SX1280 Testing
- Read Meshtastic variant.h for SX1280 pin mapping
- Created lora-test.yaml with SPI pins (SCK:12, MOSI:11, MISO:13, CS:10)
- SX1280 responded! BUSY pin toggled during reset
- RadioLib integration failed (ESPHome macro conflicts)
- Meshtastic firmware remains best option for full LoRa TX/RX

### 3. Created /tmux Skill (No Sleep!)
- `run.sh` - Start session, returns immediately
- `check.sh` - Get output instantly (no waiting)
- `watch.sh` - Diff-based wait, returns only new lines
- `send.sh` - Send keys to session
- `kill.sh` - Kill session

### 4. Created /oracle Skill
- Symlinked to `.agents/scripts/oracle.sh`
- Mother-child communication via tmux
- Commands: list, see, hey

### 5. Documented GPS Pattern
- **KEY FIX**: `restore_mode: ALWAYS_ON` for GPS power
- Secondary: TX/RX pins swapped from board labels
- Created learning + Oracle entry

---

## AI Diary

This session felt like being a hardware detective. The GPS module sat there, stubbornly outputting nothing but `\x00`, while I tried every software trick I could think of - power cycling, baud rate changes, pin swaps. I was starting to doubt myself, wondering if I had the pins wrong or if the hardware was defective.

Then the user came back after a break and said "now it working -1 how?" - and suddenly the logs were full of beautiful NMEA sentences. `ANTENNA OK`. The GPS was alive. I had to trace back through the configs to understand what changed.

The humbling part? The fix was simple: `restore_mode: ALWAYS_ON`. GPS modules need continuous power to maintain their state. Every time I power-cycled on boot, the module reset and lost everything. The user's version just... kept power on. Sometimes the simplest solutions are the ones you overlook because you're too busy being clever.

The tmux skill creation felt more comfortable - that's my territory. Fire-and-forget scripts that return immediately, diff-based watching that only triggers when there's real change. No more `sleep 30 && check` patterns wasting context. The user's question "can we do diff? loop wait not spend token" was exactly the right insight.

---

## Honest Feedback

**What worked well:**
- tmux skill scripts are clean and reusable
- GPS pattern now documented for future
- LoRa SX1280 confirmed working at SPI level
- User's hardware expertise saved the GPS debugging

**Friction points:**

1. **Too many sleep-and-check cycles** - Before the watch.sh script, I was doing `sleep 30 && check` repeatedly, burning context on waiting. Should have created the diff-based approach earlier.

2. **RadioLib + ESPHome macro conflicts** - Spent time trying to integrate RadioLib when the ESPHome/Arduino macro redefinitions make it impossible. Should have checked compatibility first before writing custom header files.

3. **Assumed TX/RX without verification** - User said "TX 41, RX 42" and I took it literally. Should have suggested trying swapped pins earlier when `\x00` persisted. Hardware debugging requires trying both orientations.

**Suggestions:**
- Create a "hardware debug checklist" for UART issues (try swap, try different baud, check power)
- Add RadioLib incompatibility note to ESPHome learnings
- tmux skill should be standard for all remote hardware work

---

## Commits This Session

```
(uncommitted) .claude/skills/tmux/ - New skill with 5 scripts
(uncommitted) .claude/skills/oracle/ - New skill, symlink to oracle.sh
(uncommitted) ψ/memory/learnings/2026-01-12_gps-uart-tx-rx-swap-pattern.md
(uncommitted) ψ/memory/learnings/2026-01-12_gps-power-alwayson-*.md (Oracle)
```

---

## Artifacts Created

| Type | File |
|------|------|
| Skill | `.claude/skills/tmux/skill.md` + 5 scripts |
| Skill | `.claude/skills/oracle/skill.md` + symlink |
| Learning | `2026-01-12_gps-uart-tx-rx-swap-pattern.md` |
| Oracle | GPS ALWAYS_ON pattern indexed |
| ESPHome | `gps-test.yaml` (working config) |
| ESPHome | `lora-test.yaml` (SPI test) |

---

## Technical Discoveries

### GPS Power Pattern
```yaml
switch:
  restore_mode: ALWAYS_ON  # THE KEY!
```

### UART TX/RX Cross-Connection
```
Board Label → ESPHome Config
TX (41)     → rx_pin: 41  (GPS sends → ESP receives)
RX (42)     → tx_pin: 42  (GPS receives ← ESP sends)
```

### tmux Diff-Based Watch
```bash
# Only returns when N+ new lines appear
watch.sh host session 5 60  # 5 lines, 60s timeout
```

---

## Next Session

- [ ] Test GPS outdoors for satellite lock
- [ ] Flash Meshtastic for full LoRa TX/RX
- [ ] Commit tmux + oracle skills
- [ ] Test watch.sh in production workflow

---

*Session ended at 91% context*
